{"version":3,"file":"OakTooltip.js","sources":["../../../../../src/components/molecules/OakTooltip/OakTooltip.tsx"],"sourcesContent":["import React, {\n  ReactElement,\n  ReactNode,\n  useLayoutEffect,\n  useState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport {\n  InternalTooltip,\n  InternalTooltipProps,\n} from \"@/components/atoms/InternalTooltip/InternalTooltip\";\nimport { OakBox, OakBoxProps } from \"@/components/atoms\";\nimport { parseSpacing } from \"@/styles/helpers/parseSpacing\";\n\nexport type OakTooltipProps = InternalTooltipProps & {\n  /**\n   * The target element that triggers the tooltip\n   */\n  children: ReactElement;\n  /**\n   * The content of the tooltip\n   */\n  tooltip: ReactNode;\n  /**\n   * Whether the tooltip is open or not\n   */\n  isOpen?: boolean;\n  /**\n   * The DOM container to render the tooltip portal into\n   *\n   * @default document.body\n   */\n  domContainer?: Element;\n};\n\n/**\n * A tooltip with oven-ready styling and positioning.\n */\nexport const OakTooltip = ({\n  tooltipPosition,\n  children,\n  tooltip,\n  isOpen,\n  domContainer,\n  ...props\n}: OakTooltipProps) => {\n  const [targetElement, setTargetElement] = useState<Element | null>(null);\n  const [isIntersecting, setIsIntersecting] = useState(true);\n  const [domContainerState, setDomContainerState] = useState<\n    Element | undefined\n  >(domContainer);\n  const isVisible = isOpen && isIntersecting;\n\n  /**\n   * The overlay is positioned on top of the target element in a portal.\n   * It tracks the target's size and position.\n   *\n   * we use it to position the tooltip relative to the target element without interfering\n   * with the page layout\n   */\n  const [overlayStyle, setOverlayStyle] = useState<{\n    top: number;\n    left: number;\n    width: number;\n    height: number;\n  }>();\n  const squaredCornerRadiusProp: keyof InternalTooltipProps = (() => {\n    switch (tooltipPosition) {\n      case \"bottom-right\":\n        return \"$btrr\";\n      case \"top-right\":\n        return \"$bbrr\";\n      case \"top-left\":\n        return \"$bblr\";\n      default:\n        return \"$btlr\";\n    }\n  })();\n  const borderRadiusProps: Partial<InternalTooltipProps> = {\n    $borderRadius: \"border-radius-m\",\n    [squaredCornerRadiusProp]: \"border-radius-square\",\n  };\n\n  useLayoutEffect(() => {\n    if (!targetElement) {\n      return;\n    }\n    let ticking = false;\n    const updateOverlayStyle = () => {\n      if (!ticking) {\n        requestAnimationFrame(() => {\n          ticking = false;\n          const rect = targetElement.getBoundingClientRect();\n\n          setOverlayStyle({\n            top: rect.top,\n            left: rect.left,\n            width: rect.width,\n            height: rect.height,\n          });\n        });\n        ticking = true;\n      }\n    };\n\n    // We use an intersection observer to detect when the target element is no longer visible\n    const intersection = new IntersectionObserver((entries) => {\n      setIsIntersecting(entries.every((entry) => entry.isIntersecting));\n    });\n    intersection.observe(targetElement);\n\n    // We use a resize observer to detect when the target element's size changes\n    const resize = new ResizeObserver(updateOverlayStyle);\n    resize.observe(targetElement);\n\n    // Update the overlay position on scroll and resize\n    window.addEventListener(\"scroll\", updateOverlayStyle, true);\n    window.addEventListener(\"resize\", updateOverlayStyle);\n\n    return () => {\n      resize.disconnect();\n      intersection.disconnect();\n      window.removeEventListener(\"scroll\", updateOverlayStyle, true);\n      window.removeEventListener(\"resize\", updateOverlayStyle);\n    };\n  }, [targetElement]);\n\n  useLayoutEffect(() => {\n    if (domContainerState) {\n      return;\n    }\n    setDomContainerState(document.body);\n  }, [domContainerState]);\n\n  return (\n    <>\n      {domContainerState &&\n        createPortal(\n          isVisible && (\n            <OakBox\n              $position=\"fixed\"\n              style={overlayStyle}\n              $pointerEvents=\"none\"\n              $zIndex=\"modal-dialog\"\n            >\n              <OakBox\n                $width=\"fit-content\"\n                $height=\"fit-content\"\n                $position=\"absolute\"\n                {...getTooltipPositionProps(tooltipPosition)}\n              >\n                <InternalTooltip\n                  $background=\"bg-decorative5-main\"\n                  $color=\"text-primary\"\n                  $pv=\"inner-padding-m\"\n                  $ph=\"inner-padding-xl\"\n                  $font=\"heading-light-7\"\n                  tooltipPosition={tooltipPosition}\n                  aria-expanded={isVisible}\n                  {...borderRadiusProps}\n                  {...props}\n                >\n                  {tooltip}\n                </InternalTooltip>\n              </OakBox>\n            </OakBox>\n          ),\n          domContainerState,\n        )}\n      <div\n        ref={(domElement) => {\n          setTargetElement(domElement?.firstElementChild ?? null);\n        }}\n        style={{ display: \"contents\" }}\n      >\n        {children}\n      </div>\n    </>\n  );\n};\n\nfunction getTooltipPositionProps(\n  tooltipPosition: OakTooltipProps[\"tooltipPosition\"],\n) {\n  const props: Partial<OakBoxProps> = {};\n\n  switch (tooltipPosition) {\n    case \"top-left\":\n    case \"top-right\":\n      props.$top = \"space-between-none\";\n      props.$transform = `translateY(calc(-100% - ${parseSpacing(\n        \"space-between-s\",\n      )}))`;\n      break;\n    default:\n      props.$bottom = \"space-between-none\";\n      props.$transform = `translateY(calc(100% + ${parseSpacing(\n        \"space-between-s\",\n      )}))`;\n      break;\n  }\n\n  switch (tooltipPosition) {\n    case \"top-left\":\n    case \"bottom-left\":\n      props.$left = \"space-between-none\";\n      break;\n    default:\n      props.$right = \"space-between-none\";\n      break;\n  }\n\n  return props;\n}\n"],"names":["OakTooltip","tooltipPosition","children","tooltip","isOpen","domContainer","props","targetElement","setTargetElement","useState","isIntersecting","setIsIntersecting","domContainerState","setDomContainerState","isVisible","overlayStyle","setOverlayStyle","borderRadiusProps","$borderRadius","useLayoutEffect","ticking","updateOverlayStyle","requestAnimationFrame","rect","getBoundingClientRect","top","left","width","height","intersection","IntersectionObserver","entries","every","entry","observe","resize","ResizeObserver","window","addEventListener","disconnect","removeEventListener","document","body","React","createElement","Fragment","createPortal","OakBox","$position","style","$pointerEvents","$width","$height","getTooltipPositionProps","InternalTooltip","$background","$color","$pv","$ph","$font","ref","domElement","firstElementChild","display","$top","$transform","parseSpacing","$bottom","$left","$right"],"mappings":"+uCAuCaA,EAAa,EACxBC,kBACAC,WACAC,UACAC,SACAC,kBACGC,MAEH,MAAOC,EAAeC,GAAoBC,EAAyB,OAC5DC,EAAgBC,GAAqBF,GAAS,IAC9CG,EAAmBC,GAAwBJ,EAEhDJ,GACIS,EAAYV,GAAUM,GASrBK,EAAcC,GAAmBP,IAkBlCQ,EAAmD,CACvDC,cAAe,kBACf,CAd0D,MAC1D,OAAQjB,GACN,IAAK,eACH,MAAO,QACT,IAAK,YACH,MAAO,QACT,IAAK,WACH,MAAO,QACT,QACE,MAAO,QAEZ,EAX2D,IAc/B,wBAsD7B,OAnDAkB,GAAgB,KACd,IAAKZ,EACH,OAEF,IAAIa,GAAU,EACd,MAAMC,EAAqB,KACpBD,IACHE,uBAAsB,KACpBF,GAAU,EACV,MAAMG,EAAOhB,EAAciB,wBAE3BR,EAAgB,CACdS,IAAKF,EAAKE,IACVC,KAAMH,EAAKG,KACXC,MAAOJ,EAAKI,MACZC,OAAQL,EAAKK,QACb,IAEJR,GAAU,EACX,EAIGS,EAAe,IAAIC,sBAAsBC,IAC7CpB,EAAkBoB,EAAQC,OAAOC,GAAUA,EAAMvB,iBAAgB,IAEnEmB,EAAaK,QAAQ3B,GAGrB,MAAM4B,EAAS,IAAIC,eAAef,GAOlC,OANAc,EAAOD,QAAQ3B,GAGf8B,OAAOC,iBAAiB,SAAUjB,GAAoB,GACtDgB,OAAOC,iBAAiB,SAAUjB,GAE3B,KACLc,EAAOI,aACPV,EAAaU,aACbF,OAAOG,oBAAoB,SAAUnB,GAAoB,GACzDgB,OAAOG,oBAAoB,SAAUnB,EAAmB,CACzD,GACA,CAACd,IAEJY,GAAgB,KACVP,GAGJC,EAAqB4B,SAASC,KAAK,GAClC,CAAC9B,IAGF+B,EAAAC,cAAAD,EAAAE,SAAA,KACGjC,GACCkC,EACEhC,GACE6B,gBAACI,EAAM,CAAAC,UACK,QACVC,MAAOlC,EACQmC,eAAA,eACP,gBAERP,EAACC,cAAAG,EACQ,CAAAI,OAAA,cACCC,QAAA,cACEJ,UAAA,cACNK,EAAwBpD,IAE5B0C,EAAAC,cAACU,EAAe,CAAAC,YACF,sBAAqBC,OAC1B,eAAcC,IACjB,kBAAiBC,IACjB,mBAAkBC,MAChB,kBACN1D,gBAAiBA,EAAe,gBACjBa,KACXG,KACAX,GAEHH,KAKTS,GAEJ+B,EAAAC,cAAA,MAAA,CACEgB,IAAMC,IACJrD,EAAiBqD,GAAYC,mBAAqB,KAAK,EAEzDb,MAAO,CAAEc,QAAS,aAEjB7D,GAGL,EAGJ,SAASmD,EACPpD,GAEA,MAAMK,EAA8B,CAAA,EAEpC,OAAQL,GACN,IAAK,WACL,IAAK,YACHK,EAAM0D,KAAO,qBACb1D,EAAM2D,WAAa,2BAA2BC,EAC5C,uBAEF,MACF,QACE5D,EAAM6D,QAAU,qBAChB7D,EAAM2D,WAAa,0BAA0BC,EAC3C,uBAKN,OAAQjE,GACN,IAAK,WACL,IAAK,cACHK,EAAM8D,MAAQ,qBACd,MACF,QACE9D,EAAM+D,OAAS,qBAInB,OAAO/D,CACT"}