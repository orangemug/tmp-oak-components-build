{"version":3,"file":"InternalChevronAccordion.js","sources":["../../../../../src/components/molecules/InternalChevronAccordion/InternalChevronAccordion.tsx"],"sourcesContent":["import React, { ReactNode, useEffect, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\n\nimport { OakHandDrawnFocusUnderline } from \"@/components/molecules/OakHandDrawnFocusUnderline\";\nimport {\n  OakBoxProps,\n  OakFlex,\n  OakIcon,\n  OakBox,\n  oakBoxCss,\n} from \"@/components/atoms\";\nimport { parseDropShadow } from \"@/styles/helpers/parseDropShadow\";\nimport {\n  InternalAccordionButton,\n  InternalAccordionContent,\n} from \"@/components/atoms/InternalAccordion\";\nimport useAccordionContext from \"@/components/atoms/InternalAccordion/useAccordionContext\";\nimport InternalAccordionProvider from \"@/components/atoms/InternalAccordion/InternalAccordionProvider\";\nimport { InternalStyledSvgProps } from \"@/components/atoms/InternalStyledSvg\";\nimport { FlexStyleProps, flexStyle } from \"@/styles/utils/flexStyle\";\nimport { parseSpacing } from \"@/styles/helpers/parseSpacing\";\nimport { parseOpacity } from \"@/styles/helpers/parseOpacity\";\nimport { ColorStyleProps } from \"@/styles/utils/colorStyle\";\n\nexport type InternalChevronAccordionProps = {\n  /**\n   * The header of the accordion\n   */\n  header: ReactNode;\n  /**\n   * Whether the accordion should be open initially\n   */\n  initialOpen?: boolean;\n  /**\n   * The content of the accordion\n   */\n  children: ReactNode;\n  /**\n   * The id of the accordion\n   */\n  id: string;\n} & FlexStyleProps &\n  OakBoxProps &\n  ColorStyleProps;\n\nconst StyledAccordionUnderline = styled(\n  OakHandDrawnFocusUnderline,\n)<InternalStyledSvgProps>`\n  position: absolute;\n  width: 100%;\n  bottom: -${parseSpacing(\"all-spacing-1\")};\n`;\n\nexport const StyledAccordionButton = styled(\n  InternalAccordionButton,\n)<FlexStyleProps>`\n  ${flexStyle}\n  ${oakBoxCss}\n  position: relative;\n  &:hover {\n    text-decoration: underline;\n  }\n  &:focus-visible {\n    .shadow {\n      box-shadow: ${parseDropShadow(\"drop-shadow-centered-lemon\")},\n        ${parseDropShadow(\"drop-shadow-centered-grey\")};\n    }\n  }\n`;\n\nconst StyledContainer = styled(OakFlex)`\n  ${StyledAccordionUnderline} {\n    visibility: hidden;\n  }\n  ${StyledAccordionButton}:focus-visible ~ ${StyledAccordionUnderline} {\n    visibility: visible;\n  }\n  ${oakBoxCss}\n  ${flexStyle}\n`;\n\ntype BottomBoxShadowProps = {\n  shouldDisplayShadow: boolean;\n};\n\nexport const BottomBoxShadow = styled(OakBox)<BottomBoxShadowProps>`\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  height: 50px;\n  opacity: ${(props) =>\n    props.shouldDisplayShadow\n      ? parseOpacity(\"opaque\")\n      : parseOpacity(\"transparent\")};\n  z-index: 100;\n  -webkit-box-shadow: inset 0px -55px 30px -30px rgba(255, 255, 255, 1);\n  -moz-box-shadow: inset 0px -55px 30px -30px rgba(255, 255, 255, 1);\n  box-shadow: inset 0px -55px 30px -30px rgba(255, 255, 255, 1);\n  padding: 2px;\n`;\n\n/**\n * An accordion component that can be used to show/hide content\n */\n\nconst Accordion = ({\n  header,\n  children,\n  id,\n  ...styleProps\n}: InternalChevronAccordionProps) => {\n  const [shouldDisplayShadow, setShouldDisplayShadow] = useState(false);\n  const scrollBox = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const scrollHeight = scrollBox.current?.scrollHeight;\n    const clientHeight = scrollBox.current?.clientHeight;\n\n    if (scrollHeight && clientHeight && scrollHeight > clientHeight) {\n      setShouldDisplayShadow(true);\n    } else {\n      setShouldDisplayShadow(false);\n    }\n  }, []);\n\n  const handleScroll = () => {\n    const scrollHeight = scrollBox.current?.scrollHeight;\n    const scrollTop = scrollBox.current?.scrollTop;\n    const clientHeight = scrollBox.current?.clientHeight;\n\n    if (scrollHeight && scrollTop) {\n      const bottom = scrollHeight - scrollTop === clientHeight;\n\n      if (bottom) {\n        setShouldDisplayShadow(false);\n      } else {\n        setShouldDisplayShadow(true);\n      }\n    }\n  };\n\n  const { isOpen } = useAccordionContext();\n\n  return (\n    <StyledContainer\n      $position={\"relative\"}\n      $pv={\"inner-padding-s\"}\n      $flexDirection={\"column\"}\n      $gap={\"all-spacing-1\"}\n      {...styleProps}\n    >\n      <StyledAccordionButton\n        id={id}\n        $width={\"100%\"}\n        $justifyContent={\"space-between\"}\n        $alignItems={\"center\"}\n      >\n        {header}\n\n        <OakBox $position={\"relative\"} $mr={\"space-between-xs\"}>\n          <OakBox\n            className=\"shadow\"\n            $position={\"absolute\"}\n            $borderRadius={\"border-radius-s\"}\n            $width={\"100%\"}\n            $height={\"100%\"}\n            $top=\"all-spacing-0\"\n          />\n          <OakIcon\n            iconName=\"chevron-down\"\n            $width=\"all-spacing-7\"\n            $height=\"all-spacing-7\"\n            alt=\"An arrow to indicate whether the item is open or closed\"\n            style={{\n              transform: isOpen ? \"rotate(180deg)\" : \"none\",\n              transition: \"all 0.3s ease 0s\",\n            }}\n          />\n        </OakBox>\n      </StyledAccordionButton>\n      <OakBox\n        ref={scrollBox}\n        $position={\"relative\"}\n        $overflow={\"scroll\"}\n        onScroll={handleScroll}\n        data-testid={\"scrollable-content\"}\n      >\n        <InternalAccordionContent aria-labelledby={id}>\n          {children}\n        </InternalAccordionContent>\n      </OakBox>\n      <StyledAccordionUnderline $fill={\"border-decorative5-stronger\"} />\n      {isOpen && (\n        <BottomBoxShadow\n          shouldDisplayShadow={shouldDisplayShadow}\n          data-testid=\"bottom-box-shadow\"\n        />\n      )}\n    </StyledContainer>\n  );\n};\n\n/**\n * InternalChevronAccordion has a chevron icon that rotates when the accordion is open\n */\n\nexport const InternalChevronAccordion = ({\n  initialOpen = false,\n  ...props\n}: InternalChevronAccordionProps) => {\n  return (\n    <InternalAccordionProvider isInitialOpen={initialOpen}>\n      <Accordion initialOpen {...props} />\n    </InternalAccordionProvider>\n  );\n};\n"],"names":["StyledAccordionUnderline","styled","OakHandDrawnFocusUnderline","parseSpacing","StyledAccordionButton","InternalAccordionButton","flexStyle","oakBoxCss","parseDropShadow","StyledContainer","OakFlex","BottomBoxShadow","OakBox","props","shouldDisplayShadow","parseOpacity","Accordion","header","children","id","styleProps","setShouldDisplayShadow","useState","scrollBox","useRef","useEffect","scrollHeight","current","clientHeight","isOpen","useAccordionContext","React","createElement","$position","$pv","$flexDirection","$gap","$justifyContent","$alignItems","$mr","className","$borderRadius","$height","$top","OakIcon","iconName","$width","alt","style","transform","transition","ref","$overflow","onScroll","scrollTop","InternalAccordionContent","$fill","InternalChevronAccordion","initialOpen","InternalAccordionProvider","isInitialOpen"],"mappings":"wzDA6CA,MAAMA,EAA2BC,EAC/BC,EACuB;;;aAGZC,EAAa;EAGbC,EAAwBH,EACnCI,EACe;IACbC;IACAC;;;;;;;oBAOgBC,EAAgB;UAC1BA,EAAgB;;;EAKpBC,EAAkBR,EAAOS,EAAQ;IACnCV;;;IAGAI,qBAAyCJ;;;IAGzCO;IACAD;EAOSK,EAAkBV,EAAOW,EAA6B;;;;;aAKrDC,GACVA,EAAMC,oBACFC,EAAa,UACbA,EAAa;;;;;;EAYfC,EAAY,EAChBC,SACAC,WACAC,QACGC,MAEH,MAAON,EAAqBO,GAA0BC,GAAS,GACzDC,EAAYC,EAAuB,MAEzCC,GAAU,KACR,MAAMC,EAAeH,EAAUI,SAASD,aAClCE,EAAeL,EAAUI,SAASC,aAGtCP,KADEK,GAAgBE,GAAgBF,EAAeE,GAIlD,GACA,IAEH,MAgBMC,OAAEA,GAAWC,IAEnB,OACEC,EAAAC,cAACvB,EAAe,CAAAwB,UACH,WAAUC,IAChB,kBAAiBC,eACN,SAAQC,KAClB,mBACFhB,GAEJW,EAACC,cAAA5B,EACC,CAAAe,GAAIA,SACI,OAAMkB,gBACG,gBAAeC,YACnB,UAEZrB,EAEDc,EAAAC,cAACpB,EAAM,CAAAqB,UAAY,WAAUM,IAAO,oBAClCR,EAAAC,cAACpB,EAAM,CACL4B,UAAU,SACCP,UAAA,WACIQ,cAAA,yBACP,OAAMC,QACL,OAAMC,KACV,kBAEPZ,EAAAC,cAACY,EAAO,CACNC,SAAS,eACFC,OAAA,gBACCJ,QAAA,gBACRK,IAAI,0DACJC,MAAO,CACLC,UAAWpB,EAAS,iBAAmB,OACvCqB,WAAY,wBAKpBnB,EAAAC,cAACpB,EAAM,CACLuC,IAAK5B,EACMU,UAAA,WACAmB,UAAA,SACXC,SA3De,KACnB,MAAM3B,EAAeH,EAAUI,SAASD,aAClC4B,EAAY/B,EAAUI,SAAS2B,UAC/B1B,EAAeL,EAAUI,SAASC,aAExC,GAAIF,GAAgB4B,EAAW,CAI3BjC,IAHaK,EAAe4B,IAAc1B,GAO7C,iBA+CgB,sBAEbG,EAAAC,cAACuB,EAA0C,CAAA,kBAAApC,GACxCD,IAGLa,EAACC,cAAAhC,EAAgC,CAAAwD,MAAA,gCAChC3B,GACCE,EAACC,cAAArB,GACCG,oBAAqBA,EAAmB,cAC5B,sBAIlB,EAOS2C,EAA2B,EACtCC,eAAc,KACX7C,KAGDkB,EAACC,cAAA2B,EAA0B,CAAAC,cAAeF,GACxC3B,EAACC,cAAAhB,GAAU0C,aAAW,KAAK7C"}