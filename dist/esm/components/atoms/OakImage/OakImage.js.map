{"version":3,"file":"OakImage.js","sources":["../../../../../src/components/atoms/OakImage/OakImage.tsx"],"sourcesContent":["import React, {\n  ComponentPropsWithoutRef,\n  ElementType,\n  MouseEventHandler,\n} from \"react\";\nimport Image, { ImageProps } from \"next/image\";\nimport styled, { css } from \"styled-components\";\n\nimport { useShowPlaceholder } from \"./useShowPlaceholder\";\n\nimport {\n  ColorFilterStyleProps,\n  colorFilterStyle,\n} from \"@/styles/utils/colorFilterStyle\";\nimport { OakBox, OakBoxProps } from \"@/components/atoms/OakBox\";\nimport { parseColor } from \"@/styles/helpers/parseColor\";\nimport { parseSpacing } from \"@/styles/helpers/parseSpacing\";\n\ntype HTMLProps = {\n  onClick?: MouseEventHandler;\n};\n\nexport type OakImageProps<C extends ElementType = typeof Image> = Omit<\n  ImageProps,\n  \"placeholder\"\n> &\n  OakBoxProps &\n  ColorFilterStyleProps &\n  HTMLProps & {\n    as?: C;\n    /**\n     * The placeholder to use while the image is loading\n     *\n     * Defaults to `oak` which is a placeholder containing the Oak logo\n     * also accepts the same options as next/image */\n    placeholder?: ImageProps[\"placeholder\"] | \"oak\";\n    /**\n     * Additional props forwarded to the underlying `Image` component `as`\n     */\n    imageProps?: Partial<ComponentPropsWithoutRef<C>>;\n  };\n\ntype StyledImageProps = Omit<OakImageProps, \"as\"> & {\n  $showOakPlaceholder: boolean;\n};\n\nexport const oakPlaceholder =\n  \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHBhdGggZmlsbD0iIzIyMiIgZD0iTTI4Ljc3OSAxOS4xNzZhMjcuMTkxIDI3LjE5MSAwIDAgMC0zLjggMS42IDE2LjcgMTYuNyAwIDAgMC03LjEgOC40YzAgLjEtLjEuMi0uMS4zLS43IDIuNC0uNiAyIDEuMyAyLjMgMS45LjMgMSAuNSAxIDEuMy0uMSA4LjggNC4xIDE1LjEgMTEuNCAxOS42YTEuNSAxLjUgMCAwIDAgMS43LjJjNS43LTIuNiA5LjMtNyAxMC4zLTEzLjJhMSAxIDAgMCAxIDEtMWwzLS4yYy44IDAgMS4zLjIgMS4yIDEuMmExNy45IDE3LjkgMCAwIDEtMy4yIDkuMiAyMy43IDIzLjcgMCAwIDEtMTAuOSA5LjEgNS40MDEgNS40MDEgMCAwIDEtNC41LS4yIDI2LjI5OCAyNi4yOTggMCAwIDEtOC41LTYuNiAyNS45IDI1LjkgMCAwIDEtNi40LTE0LjRjMC0uNi0uMi0uNy0uOC0uOC0yLjUtLjQtMi41LS4xLTIuMy0yLjlhMTkuMyAxOS4zIDAgMCAxIDEwLjgtMTYuNiAzOC45OTkgMzguOTk5IDAgMCAxIDUuNy0yLjEgMi4xIDIuMSAwIDAgMCAuOS0xLjMgMTQuMSAxNC4xIDAgMCAxIDMuNS02LjNsLjMtLjNjMS45LTIgMi42LTIgNC4zLjJsLjQuNWMxLjEgMS4xIDEgMS41LS4xIDIuNmExMS45IDExLjkgMCAwIDAtMy4yIDQuNCAxNi45IDE2LjkgMCAwIDEgNy41IDIuM2M1LjcgMy41IDkuMiA4LjMgOS45IDE1IC4wMTYuOTAxLS4wMTcgMS44MDItLjEgMi43IDAgLjgtLjYgMS0xLjIgMS4yYTE2LjEgMTYuMSAwIDAgMS0xMS0uNyAxNy45MDEgMTcuOTAxIDAgMCAxLTEwLjktMTMuNiA5Ljc5NiA5Ljc5NiAwIDAgMS0uMS0xLjlabTE4LjEgMTIuMmMuNC01LjUtNi45LTEyLjYtMTMtMTIuMS41IDYuNSA3LjYgMTIuOCAxMyAxMi4xWiIgb3BhY2l0eT0iLjEiLz48L3N2Zz4=\";\n\nconst clickStyles = css<{ onClick?: MouseEventHandler }>`\n  ${(props) =>\n    /* onClick might be passed in the useClickableCard pattern */\n    props.onClick &&\n    css`\n      :hover {\n        cursor: pointer;\n      }\n    `}\n`;\n\nexport const placeholderStyles = css<StyledImageProps>`\n  ${(props) =>\n    props.$showOakPlaceholder &&\n    css`\n      background-image: url(${oakPlaceholder});\n      background-color: ${parseColor(\"bg-decorative2-very-subdued\")};\n      background-size: ${parseSpacing(\"all-spacing-11\")};\n      background-position: center;\n      background-repeat: no-repeat;\n    `}\n`;\n\nconst StyledFillImage = styled(Image)<StyledImageProps>`\n  ${colorFilterStyle}\n  ${clickStyles}\n  ${placeholderStyles}\n  ${(props) => css`\n    object-fit: ${props.$objectFit ? props.$objectFit : \"contain\"};\n  `}\n`;\n\nconst StyledResponsiveImage = styled(Image)<StyledImageProps>`\n  ${colorFilterStyle}\n  ${clickStyles}\n  ${placeholderStyles}\n  width: 100%;\n  height: auto;\n`;\n\n/**\n * A wrapper for NextJs's Image component.\n *\n * Use this for all image types as well as icons.\n * Can accept remote urls provided they are whitelisted in next.config.js and relative urls for local images provided they begin with a \"/\".\n * Set the width and height of the image through the `$width` and `$height` props when the aspect ratio is not known. This will letterbox the image to avoid stretching.\n * Alternatively pass `width` and `height` props when the aspect ratio is known and use $minWidth to set the rendered width, avoiding letter-boxing.\n * NB. for letterboxed images, $background controls the color of the letterbox not the image.\n * `positionStyle` and `spacingStyle` props are also exposed for container.\n * sizes is exposed for further optimisation read Next docs for more info.\n *\n */\nexport const OakImage = <C extends ElementType = typeof Image>({\n  ...props\n}: OakImageProps<C>) => {\n  const {\n    as,\n    src,\n    alt,\n    width,\n    height,\n    sizes,\n    $width = \"100%\",\n    $position = \"relative\",\n    $colorFilter,\n    placeholder = \"oak\",\n    unoptimized,\n    imageProps,\n    $objectFit,\n    onLoad,\n    onError,\n    ...rest\n  } = props;\n\n  const finalPlaceholder = placeholder === \"oak\" ? undefined : placeholder;\n  const { showPlaceholder, handleComplete, setImg } = useShowPlaceholder();\n\n  // We don't know the aspect ratio of the image, so we must use fill and letterbox it to avoid stretching\n  // Use $width and $height to set the width and height of the image container\n  if (!width || !height) {\n    return (\n      <OakBox $position={$position} $width={$width} {...rest}>\n        <StyledFillImage\n          ref={setImg}\n          as={as ?? Image}\n          src={src}\n          alt={alt}\n          sizes={sizes}\n          fill\n          $colorFilter={$colorFilter}\n          placeholder={finalPlaceholder}\n          $showOakPlaceholder={placeholder === \"oak\" && showPlaceholder}\n          unoptimized={unoptimized}\n          onLoad={handleComplete(onLoad)}\n          onError={handleComplete(onError)}\n          $objectFit={$objectFit}\n          {...imageProps}\n        />\n      </OakBox>\n    );\n  }\n\n  // When we know the aspect ratio, we can use Image's repsonsive layout\n  // Use $minWidth to set the width with auto height\n\n  return (\n    <OakBox $maxWidth={\"all-spacing-0\"} $position={$position} {...rest}>\n      <StyledResponsiveImage\n        ref={setImg}\n        as={as ?? Image}\n        src={src}\n        alt={alt}\n        width={width}\n        height={height}\n        sizes={sizes}\n        unoptimized={unoptimized}\n        $colorFilter={$colorFilter}\n        placeholder={finalPlaceholder}\n        $showOakPlaceholder={placeholder === \"oak\" && showPlaceholder}\n        onLoad={handleComplete(onLoad)}\n        onError={handleComplete(onError)}\n        {...imageProps}\n      />\n    </OakBox>\n  );\n};\n"],"names":["oakPlaceholder","clickStyles","css","props","onClick","placeholderStyles","$showOakPlaceholder","parseColor","parseSpacing","StyledFillImage","styled","Image","colorFilterStyle","$objectFit","StyledResponsiveImage","OakImage","as","src","alt","width","height","sizes","$width","$position","$colorFilter","placeholder","unoptimized","imageProps","onLoad","onError","rest","finalPlaceholder","undefined","showPlaceholder","handleComplete","setImg","useShowPlaceholder","React","OakBox","$maxWidth","createElement","ref","fill"],"mappings":"2ZA8CO,MAAMA,EACX,ytCAEIC,EAAcC,CAAoC;IACnDC,GAEDA,EAAMC,SACNF,CAAG;;;;;EAOMG,EAAoBH,CAAqB;IACjDC,GACDA,EAAMG,qBACNJ,CAAG;8BACuBF;0BACJO,EAAW;yBACZC,EAAa;;;;EAMhCC,EAAkBC,EAAOC,EAAwB;IACnDC;IACAX;IACAI;IACCF,GAAUD,CAAG;kBACAC,EAAMU,WAAaV,EAAMU,WAAa;;EAIlDC,EAAwBJ,EAAOC,EAAwB;IACzDC;IACAX;IACAI;;;EAiBSU,EAAW,KACnBZ,MAEH,MAAMa,GACJA,EAAEC,IACFA,EAAGC,IACHA,EAAGC,MACHA,EAAKC,OACLA,EAAMC,MACNA,EAAKC,OACLA,EAAS,OAAMC,UACfA,EAAY,WAAUC,aACtBA,EAAYC,YACZA,EAAc,MAAKC,YACnBA,EAAWC,WACXA,EAAUd,WACVA,EAAUe,OACVA,EAAMC,QACNA,KACGC,GACD3B,EAEE4B,EAAmC,QAAhBN,OAAwBO,EAAYP,GACvDQ,gBAAEA,EAAeC,eAAEA,EAAcC,OAAEA,GAAWC,IAIpD,OAAKjB,GAAUC,EA2BbiB,gBAACC,EAAM,CAAAC,UAAY,gBAA4BhB,UAAAA,KAAeO,GAC5DO,EAAAG,cAAC1B,EAAqB,CACpB2B,IAAKN,EACLnB,GAAIA,GAAML,EACVM,IAAKA,EACLC,IAAKA,EACLC,MAAOA,EACPC,OAAQA,EACRC,MAAOA,EACPK,YAAaA,EACCF,aAAAA,EACdC,YAAaM,EACQzB,oBAAgB,QAAhBmB,GAAyBQ,EAC9CL,OAAQM,EAAeN,GACvBC,QAASK,EAAeL,MACpBF,KAxCNU,gBAACC,EAAM,CAAAf,UAAYA,EAAmBD,OAAAA,KAAYQ,GAChDO,EAAAG,cAAC/B,EAAe,CACdgC,IAAKN,EACLnB,GAAIA,GAAML,EACVM,IAAKA,EACLC,IAAKA,EACLG,MAAOA,EACPqB,MAAI,EAAAlB,aACUA,EACdC,YAAaM,EACQzB,oBAAgB,QAAhBmB,GAAyBQ,EAC9CP,YAAaA,EACbE,OAAQM,EAAeN,GACvBC,QAASK,EAAeL,GACZhB,WAAAA,KACRc,IA4BV"}