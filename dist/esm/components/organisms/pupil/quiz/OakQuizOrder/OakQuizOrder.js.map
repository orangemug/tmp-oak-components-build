{"version":3,"file":"OakQuizOrder.js","sources":["../../../../../../../src/components/organisms/pupil/quiz/OakQuizOrder/OakQuizOrder.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport {\n  closestCenter,\n  KeyboardSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n  DragOverlay,\n  DragStartEvent,\n  UniqueIdentifier,\n  Announcements,\n  MouseSensor,\n  TouchSensor,\n} from \"@dnd-kit/core\";\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  verticalListSortingStrategy,\n} from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { createPortal } from \"react-dom\";\n\nimport { OakFlex } from \"@/components/atoms\";\nimport {\n  OakCodeRenderer,\n  OakDragAndDropInstructions,\n  OakDraggable,\n  OakDroppable,\n} from \"@/components/molecules\";\nimport { InternalDndContext } from \"@/components/atoms/InternalDndContext/InternalDndContext\";\nimport { usePrefersReducedMotion } from \"@/animation/usePrefersReducedMotion\";\n\ntype OakQuizOrderItem = {\n  id: string;\n  label: string;\n};\n\nexport type OakQuizOrderProps = {\n  /**\n   * The initial order of items\n   *\n   * this cannot be updated on subsequent renders\n   */\n  initialItems: OakQuizOrderItem[];\n  /**\n   * Notified the consumer when the order of items has changed\n   */\n  onChange?: (items: OakQuizOrderItem[]) => void;\n  /**\n   * Highlight all items to indicate that they can be interacted with\n   */\n  isHighlighted?: boolean;\n};\n\nconst ConnectedDraggable = ({\n  id,\n  label,\n  isHighlighted,\n}: OakQuizOrderItem & { isHighlighted?: boolean }) => {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isOver,\n    isDragging,\n  } = useSortable({ id });\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n  };\n\n  return (\n    <OakDroppable isOver={isOver} isHighlighted={isHighlighted}>\n      <OakDraggable\n        ref={setNodeRef}\n        style={style}\n        isDisabled={isDragging}\n        {...attributes}\n        {...listeners}\n        aria-describedby={undefined}\n        aria-roledescription=\"sortable item\"\n        aria-pressed={undefined}\n        aria-selected={!!attributes[\"aria-pressed\"]}\n        role=\"option\"\n      >\n        <OakCodeRenderer string={label} />\n      </OakDraggable>\n    </OakDroppable>\n  );\n};\n\n/**\n * A sortable list of items with drag and drop functionality. Items can be dragged over named slots to re-arrange them\n *\n * Keyboard navigation is supported with the `tab`, `space` and `arrow` keys\n */\nexport const OakQuizOrder = ({\n  initialItems,\n  onChange,\n  isHighlighted,\n}: OakQuizOrderProps) => {\n  const [items, setItems] = useState<OakQuizOrderItem[]>(initialItems);\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const activeItem = items.find((item) => item.id === activeId);\n  const sensors = useSensors(\n    useSensor(MouseSensor),\n    useSensor(TouchSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n      scrollBehavior: usePrefersReducedMotion() ? \"instant\" : \"smooth\",\n    }),\n  );\n\n  return (\n    <>\n      <OakDragAndDropInstructions $mb=\"space-between-m2\" />\n      <InternalDndContext\n        sensors={sensors}\n        collisionDetection={closestCenter}\n        onDragEnd={handleDragEnd}\n        onDragStart={handleDragStart}\n        accessibility={{\n          announcements: createAccouncements(items),\n        }}\n      >\n        <SortableContext items={items} strategy={verticalListSortingStrategy}>\n          <OakFlex\n            $gap=\"space-between-s\"\n            $flexDirection=\"column\"\n            role=\"listbox\"\n            aria-label=\"Sortable items\"\n          >\n            {items.map((item) => (\n              <ConnectedDraggable\n                key={item.id}\n                {...item}\n                isHighlighted={isHighlighted}\n              />\n            ))}\n          </OakFlex>\n          {createPortal(\n            <DragOverlay>\n              {activeItem && (\n                <OakDraggable isDragging>\n                  <OakCodeRenderer string={activeItem.label} />\n                </OakDraggable>\n              )}\n            </DragOverlay>,\n            document.body,\n          )}\n        </SortableContext>\n      </InternalDndContext>\n    </>\n  );\n\n  function handleDragStart(event: DragStartEvent) {\n    const { active } = event;\n    setActiveId(active.id.toString());\n  }\n\n  function handleDragEnd(event: DragEndEvent) {\n    const { active, over } = event;\n\n    if (active.id !== over?.id) {\n      setItems((items) => {\n        const oldIndex = items.findIndex((item) => item.id === active.id);\n        const newIndex = items.findIndex((item) => item.id === over?.id);\n        const newItems = arrayMove(items, oldIndex, newIndex);\n\n        onChange?.(newItems);\n\n        return newItems;\n      });\n    }\n\n    setActiveId(null);\n  }\n};\n\nfunction createAccouncements(items: OakQuizOrderItem[]): Announcements {\n  const getPosition = (id: UniqueIdentifier) =>\n    items.findIndex((item) => item.id === id) + 1;\n  const getItemLabel = (id: UniqueIdentifier) =>\n    items.find((item) => item.id === id)?.label;\n\n  return {\n    onDragStart() {\n      return undefined;\n    },\n    onDragOver({ active, over }) {\n      if (over) {\n        return `Sortable item ${getItemLabel(\n          active.id,\n        )} is in position ${getPosition(over.id)} of ${items.length}`;\n      }\n    },\n    onDragEnd({ active, over }) {\n      if (over) {\n        return `Sortable item ${getItemLabel(\n          active.id,\n        )} was dropped into position ${getPosition(over.id)} of ${\n          items.length\n        }`;\n      }\n    },\n    onDragCancel({ active }) {\n      return `Dragging was cancelled. Sortable item ${getItemLabel(\n        active.id,\n      )} was dropped.`;\n    },\n  };\n}\n"],"names":["ConnectedDraggable","id","label","isHighlighted","attributes","listeners","setNodeRef","transform","transition","isOver","isDragging","useSortable","style","CSS","Transform","toString","React","createElement","OakDroppable","OakDraggable","ref","isDisabled","undefined","role","OakCodeRenderer","string","OakQuizOrder","initialItems","onChange","items","setItems","useState","activeId","setActiveId","activeItem","find","item","sensors","useSensors","useSensor","MouseSensor","TouchSensor","KeyboardSensor","coordinateGetter","sortableKeyboardCoordinates","scrollBehavior","usePrefersReducedMotion","Fragment","OakDragAndDropInstructions","$mb","InternalDndContext","collisionDetection","closestCenter","onDragEnd","event","active","over","oldIndex","findIndex","newIndex","newItems","arrayMove","onDragStart","accessibility","announcements","createAccouncements","SortableContext","strategy","verticalListSortingStrategy","OakFlex","$gap","$flexDirection","map","key","createPortal","DragOverlay","document","body","getPosition","getItemLabel","onDragOver","length","onDragCancel"],"mappings":"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"}