{"version":3,"file":"OakModalCenter.js","sources":["../../../../../src/components/molecules/OakModalCenter/OakModalCenter.tsx"],"sourcesContent":["import React, {\n  HTMLAttributes,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { FocusOn } from \"react-focus-on\";\nimport { Transition, TransitionStatus } from \"react-transition-group\";\nimport styled from \"styled-components\";\n\nimport { InternalShadowRoundButton } from \"@/components/molecules/InternalShadowRoundButton\";\nimport { OakBox, OakFlex, OakFlexProps, oakBoxCss } from \"@/components/atoms\";\nimport { parseSpacing } from \"@/styles/helpers/parseSpacing\";\n\nexport type OakModalCenterProps = {\n  /**\n   * The content of the modal. Use with `<OakModalCenterBody>` for best results.\n   */\n  children: ReactNode;\n  /**\n   * Determines whether to show the modal or not\n   */\n  isOpen: boolean;\n  /**\n   * Override HTMLAttributes & OakFlex props for the modal container\n   */\n  modalFlexProps?: Partial<OakFlexProps & HTMLAttributes<Element>>;\n  /**\n   * Override HTMLAttributes & OakFlex props for the inner modal container\n   */\n  modalInnerFlexProps?: Partial<OakFlexProps & HTMLAttributes<Element>>;\n  /**\n   * Override HTMLAttributes & OakFlex props for the backdrop container\n   */\n  backdropFlexProps?: Partial<OakFlexProps & HTMLAttributes<Element>>;\n  /**\n   * If true, clicking the backdrop will not call onClose\n   */\n  disableBackdropClick?: boolean;\n  /**\n   * If true, pressing the escape key will not call onClose\n   */\n  disableEscapeKey?: boolean;\n  /**\n   * If true, the close button will be hidden\n   */\n  hideCloseButton?: boolean;\n  /**\n   * Called when the modal is closed via the close button, backdrop click, or escape key\n   */\n  onClose?: () => void;\n  /**\n   * The DOM container to render the modal portal into.\n   */\n  domContainer?: Element;\n  /**\n   * Slot for the footer of the modal\n   */\n  footerSlot?: ReactNode;\n};\n\nconst FocusOnBox = styled(FocusOn)`\n  ${oakBoxCss}\n`;\n\nconst BlurredOakBox = styled(OakBox)`\n  backdrop-filter: blur(3px);\n`;\n\nconst FadeInFlex = styled(OakFlex)<{ $state: TransitionStatus }>`\n  opacity: ${({ $state }) => {\n    switch ($state) {\n      case \"entered\":\n      case \"entering\":\n        return \"1\";\n      default:\n        return \"0\";\n    }\n  }};\n  transition: opacity 0s;\n`;\n\n/**\n * Centered modal dialog with trapped focus, close button, backdrop click, and escape key handling.\n *\n * ## Props\n *\n * - **isOpen** \\-                  If true the modal will be open, if false it will be closed\n * - **onClose** \\-                 Called when the modal is closed via the close button, backdrop click, or escape key\n * - **children** \\-                The content of the modal. Use with `<OakModalCenterBody>` for best results.\n * - **domContainer** \\-            The DOM container to render the modal portal into.\n * - **disableBackdropClick?** \\-   If true, clicking the backdrop will not call onClose\n * - **disableEscapeKey?** \\-       If true, pressing the escape key will not call onClose\n * - **hideCloseButton?** \\-        If true, the close button will be hidden\n * - **modalFlexProps?** \\-         Override HTMLAttributes & OakFlex props for the modal container\n * - **modalInnerFlexProps?** \\-    Override HTMLAttributes & OakFlex props for the inner modal container\n * - **backdropFlexProps?** \\-      Override HTMLAttributes & OakFlex props for the backdrop container\n * - **footerSlot?** \\-             Fixed area at the bottom of the modal, this will remain fixed in view if the content is scrollable\n */\nexport const OakModalCenter = ({\n  children,\n  domContainer,\n  isOpen,\n  onClose = () => {},\n  disableBackdropClick = false,\n  disableEscapeKey = false,\n  hideCloseButton = false,\n  modalFlexProps,\n  modalInnerFlexProps,\n  backdropFlexProps,\n  footerSlot,\n}: OakModalCenterProps) => {\n  const [scrollBorders, setScrollBorders] = useState({\n    top: false,\n    bottom: false,\n  });\n  const transitionRef = useRef<HTMLDivElement>(null);\n  const scrollBoxRef = useRef<HTMLDivElement>(null);\n\n  const checkForScroll = useCallback(() => {\n    // To show some borders when the content is scrollable\n    const scrollBoxElem = scrollBoxRef.current;\n    if (!scrollBoxElem) {\n      return;\n    }\n\n    if (scrollBoxElem.scrollHeight > scrollBoxElem.clientHeight) {\n      scrollBoxRef.current.tabIndex = 0;\n    }\n\n    setScrollBorders({\n      top: scrollBoxElem.scrollTop > 0,\n      bottom: scrollBoxElem.scrollHeight > scrollBoxElem.clientHeight,\n    });\n  }, []);\n\n  useLayoutEffect(() => {\n    checkForScroll();\n    scrollBoxRef.current?.addEventListener(\"scroll\", checkForScroll);\n    return () => {\n      scrollBoxRef.current?.removeEventListener(\"scroll\", checkForScroll);\n    };\n  }, [isOpen]);\n\n  useEffect(() => {\n    window.addEventListener(\"resize\", checkForScroll);\n    return () => {\n      window.removeEventListener(\"resize\", checkForScroll);\n    };\n  });\n\n  const isClientSide = typeof window !== \"undefined\";\n\n  const modal = (\n    <Transition\n      in={isOpen}\n      nodeRef={transitionRef}\n      addEndListener={(done) => {\n        transitionRef.current?.addEventListener(\"transitionend\", done);\n      }}\n      timeout={0}\n      mountOnEnter\n      unmountOnExit\n    >\n      {(state) => (\n        <FadeInFlex\n          ref={transitionRef}\n          $state={state}\n          $position=\"fixed\"\n          $inset=\"all-spacing-0\"\n          $justifyContent=\"center\"\n          $alignItems=\"center\"\n          $zIndex=\"modal-dialog\"\n        >\n          <BlurredOakBox\n            $position=\"fixed\"\n            $inset=\"all-spacing-0\"\n            $zIndex=\"behind\"\n            $background=\"blackSemiTransparent\"\n            data-testid=\"backdrop\"\n            {...backdropFlexProps}\n          />\n          <OakFlex\n            $alignItems=\"center\"\n            $justifyContent=\"center\"\n            $maxWidth=\"all-spacing-23\"\n            $width=\"100%\"\n            $pa=\"inner-padding-l\"\n          >\n            <FocusOnBox\n              onEscapeKey={() => !disableEscapeKey && onClose()}\n              onClickOutside={() => !disableBackdropClick && onClose()}\n              returnFocus\n              autoFocus\n              $width=\"100%\"\n            >\n              <OakFlex\n                $flexDirection=\"column\"\n                $background=\"white\"\n                $borderRadius=\"border-radius-l\"\n                $width=\"100%\"\n                $position=\"relative\"\n                role=\"alertdialog\"\n                style={{\n                  maxHeight: `calc(100vh - ${parseSpacing(\n                    \"inner-padding-xl5\",\n                  )} - ${parseSpacing(\"inner-padding-xl5\")})`,\n                }}\n                {...modalFlexProps}\n              >\n                <OakBox $minHeight=\"inner-padding-xl5\" $position=\"relative\">\n                  {!hideCloseButton && (\n                    <OakBox\n                      $position=\"absolute\"\n                      $top=\"all-spacing-3\"\n                      $right=\"all-spacing-3\"\n                    >\n                      <InternalShadowRoundButton\n                        onClick={onClose}\n                        aria-label=\"Close Modal\"\n                        defaultIconBackground=\"transparent\"\n                        defaultIconColor=\"black\"\n                        defaultTextColor=\"transparent\"\n                        hoverTextColor=\"transparent\"\n                        disabledTextColor=\"transparent\"\n                        hoverIconBackground=\"black\"\n                        hoverIconColor=\"white\"\n                        disabledIconBackground=\"transparent\"\n                        iconBackgroundSize=\"all-spacing-7\"\n                        iconSize=\"all-spacing-7\"\n                        iconName=\"cross\"\n                        data-testid=\"close-button\"\n                      />\n                    </OakBox>\n                  )}\n                </OakBox>\n                <div style={{ display: \"contents\" }} data-autofocus-inside>\n                  <OakFlex\n                    ref={scrollBoxRef}\n                    data-testid=\"modal-main-content\"\n                    $overflow=\"auto\"\n                    $flexDirection=\"column\"\n                    $ph=\"inner-padding-xl5\"\n                    $bt={\n                      scrollBorders.top ? \"border-solid-s\" : \"border-solid-none\"\n                    }\n                    $bb={\n                      scrollBorders.bottom\n                        ? \"border-solid-s\"\n                        : \"border-solid-none\"\n                    }\n                    $borderColor=\"border-neutral-lighter\"\n                    {...modalInnerFlexProps}\n                  >\n                    {children}\n                  </OakFlex>\n                  {footerSlot}\n                </div>\n              </OakFlex>\n            </FocusOnBox>\n          </OakFlex>\n        </FadeInFlex>\n      )}\n    </Transition>\n  );\n\n  if (domContainer && isClientSide) {\n    return createPortal(modal, domContainer);\n  } else {\n    return modal;\n  }\n};\n"],"names":["FocusOnBox","styled","FocusOn","oakBoxCss","BlurredOakBox","OakBox","FadeInFlex","OakFlex","$state","children","domContainer","isOpen","onClose","disableBackdropClick","disableEscapeKey","hideCloseButton","modalFlexProps","modalInnerFlexProps","backdropFlexProps","footerSlot","scrollBorders","setScrollBorders","useState","top","bottom","transitionRef","useRef","scrollBoxRef","checkForScroll","useCallback","scrollBoxElem","current","scrollHeight","clientHeight","tabIndex","scrollTop","useLayoutEffect","addEventListener","removeEventListener","useEffect","window","isClientSide","modal","React","Transition","in","nodeRef","addEndListener","done","timeout","mountOnEnter","unmountOnExit","state","createElement","ref","$position","$inset","$justifyContent","$alignItems","default","$zIndex","$background","$width","$pa","onEscapeKey","onClickOutside","returnFocus","autoFocus","$flexDirection","role","style","maxHeight","parseSpacing","$minHeight","$top","InternalShadowRoundButton","onClick","defaultIconBackground","defaultIconColor","defaultTextColor","hoverTextColor","disabledTextColor","hoverIconBackground","hoverIconColor","disabledIconBackground","iconBackgroundSize","iconSize","iconName","display","$overflow","$ph","$bt","$bb","$borderColor","createPortal"],"mappings":"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"}