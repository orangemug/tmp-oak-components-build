{"version":3,"file":"OakCodeRenderer.js","sources":["../../../../../src/components/molecules/OakCodeRenderer/OakCodeRenderer.tsx"],"sourcesContent":["import React, { ReactElement } from \"react\";\nimport styled from \"styled-components\";\n\nimport { OakBox, OakFlex, OakSpan, OakBoxProps } from \"@/components/atoms\";\nimport { OakCombinedColorToken } from \"@/styles\";\nimport { TypographyStyleProps } from \"@/styles/utils/typographyStyle\";\n\nconst StyledCodeContainer = styled(OakBox)`\n  font-family: \"Roboto Mono\", --font-roboto-mono, monospace;\n`;\n\nexport type OakCodeRendererProps = {\n  string: string;\n} & TypographyStyleProps &\n  OakBoxProps;\n\nexport const OakCodeRenderer = ({ string, ...rest }: OakCodeRendererProps) => {\n  const findAndStyleInlineCode = (text: string) => {\n    const parts = text.split(/(`.*?`)/); // Matches text enclosed in backticks\n    if (parts.length === 1 && !text.startsWith(\"`\")) {\n      return text;\n    }\n    return (\n      <OakSpan>\n        {parts.map((part, index) => {\n          if (part.startsWith(\"`\") && part.endsWith(\"`\")) {\n            // Remove backticks and style the content\n            return (\n              <StyledCodeContainer\n                key={index}\n                $background={\"grey70\"}\n                $color={\"white\"}\n                $pv={[\"inner-padding-none\", \"inner-padding-ssx\"]}\n                $ph={[\"inner-padding-xs\", \"inner-padding-xs\"]}\n                $borderRadius={\"border-radius-m2\"}\n                $display={\"inline-block\"}\n                $font={[\"code-2\", \"code-1\"]}\n                {...rest}\n              >\n                {part.slice(1, -1)}\n              </StyledCodeContainer>\n            );\n          }\n          return part; // Return the unstyled part\n        })}\n      </OakSpan>\n    );\n  };\n\n  const syntaxHighlight = (code: string) => {\n    // Define regex patterns for different code parts\n    const patterns: { regex: RegExp; color: OakCombinedColorToken }[] = [\n      { regex: /\"(.*?)\"|'(.*?)'/g, color: \"code-green\" }, // Strings\n      {\n        regex:\n          /\\b(and|as|assert|async|await|break|class|continue|def|del|elif|else|except|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|raise|return|try|while|with|yield)\\b/g,\n        color: \"code-pink\",\n      }, // Keywords\n      {\n        regex: /\\b(False|None|True)\\b/g,\n        color: \"code-blue\",\n      }, // Keywords\n\n      { regex: /\\b\\d+\\b/g, color: \"code-blue\" }, // Numbers\n      // { regex: /(#.*?$)/gm, color: \"code-grey\" }, // Comments\n      //   { regex: /(=|==|!=|<=|>=|\\+|-|\\*|\\/|:)/g, color: \"red\" }, // Operators\n    ];\n\n    // Apply syntax highlighting by replacing matches with styled spans\n    const parts: (string | ReactElement)[] = [code];\n    let isCheckingMatches = true;\n    while (isCheckingMatches) {\n      let matchFound = false;\n      parts.forEach((part, index) => {\n        for (const { regex, color } of patterns) {\n          if (typeof part === \"string\") {\n            const match = regex.exec(part);\n            if (match) {\n              matchFound = true;\n              const [matchedText] = match;\n              parts.splice(index, 1);\n              parts.splice(index, 0, part.slice(0, match.index));\n              parts.splice(\n                index + 1,\n                0,\n                <OakSpan key={`${part}-${index}`} $color={color}>\n                  {matchedText}\n                </OakSpan>,\n              );\n              parts.splice(\n                index + 2,\n                0,\n                part.slice(match.index + matchedText.length),\n              );\n              break;\n            }\n          }\n        }\n      });\n      if (!matchFound) {\n        isCheckingMatches = false;\n        return parts;\n      }\n    }\n  };\n\n  const StyleCodeBlock = (text: string, index: number) => {\n    const matches = text.match(/```([\\s\\S]*?)```/);\n    if (!matches) return text;\n\n    // Extract the content inside the backticks\n    const codeContent = matches[1];\n    if (!codeContent) return text;\n    // Apply syntax highlighting\n\n    const codeWithSyntaxHighlighting = syntaxHighlight(codeContent);\n\n    return (\n      <StyledCodeContainer\n        key={`${text}-${index}`}\n        $background={\"grey70\"}\n        $color={\"code-grey\"}\n        $pv={\"inner-padding-xs\"}\n        $ph={\"inner-padding-s\"}\n        $borderRadius={\"border-radius-m2\"}\n        $whiteSpace={\"pre-wrap\"}\n        $mt={\"space-between-xl\"}\n        $font={\"code-2\"}\n        {...rest}\n      >\n        <OakFlex $flexDirection={\"row\"}>\n          <OakFlex\n            $flexDirection={\"column\"}\n            $br={\"border-solid-s\"}\n            $borderColor={\"border-neutral\"}\n            $pr={\"inner-padding-s\"}\n          >\n            {codeContent.split(\"\\n\").map((line, index) => (\n              <OakSpan key={`${line}-${index}`}>{index + 1}</OakSpan>\n            ))}\n          </OakFlex>\n          <OakSpan $pl={\"inner-padding-s\"}>\n            {codeWithSyntaxHighlighting}\n          </OakSpan>\n        </OakFlex>\n      </StyledCodeContainer>\n    );\n  };\n  const extractAndMap = (text: string) => {\n    const parts = text.split(/(```[\\s\\S]*?```)/);\n    if (parts.length === 1 && !text.startsWith(\"```\")) {\n      return findAndStyleInlineCode(text);\n    }\n    return (\n      <OakFlex $flexDirection={\"column\"}>\n        {parts.map((part, index) => {\n          if (part.startsWith(\"```\") && part.endsWith(\"```\")) {\n            return StyleCodeBlock(part, index);\n          }\n          return (\n            <OakSpan key={`${part}-${index}`}>\n              {findAndStyleInlineCode(part)}\n            </OakSpan>\n          );\n        })}\n      </OakFlex>\n    );\n  };\n\n  return extractAndMap(string);\n};\n"],"names":["StyledCodeContainer","styled","OakBox","string","rest","findAndStyleInlineCode","text","parts","split","length","startsWith","React","default","createElement","OakSpan","map","part","index","endsWith","key","$color","$pv","$ph","$display","$font","slice","StyleCodeBlock","matches","match","codeContent","codeWithSyntaxHighlighting","code","patterns","regex","color","isCheckingMatches","matchFound","forEach","exec","matchedText","splice","syntaxHighlight","$background","$borderRadius","$whiteSpace","$mt","OakFlex","$br","$borderColor","line","$flexDirection","extractAndMap"],"mappings":"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"}