{"version":3,"file":"OakQuizOrder.js","sources":["../../../../../../../src/components/organisms/pupil/quiz/OakQuizOrder/OakQuizOrder.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport {\n  closestCenter,\n  KeyboardSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n  DragOverlay,\n  DragStartEvent,\n  UniqueIdentifier,\n  Announcements,\n  MouseSensor,\n  TouchSensor,\n} from \"@dnd-kit/core\";\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  verticalListSortingStrategy,\n} from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { createPortal } from \"react-dom\";\n\nimport { OakFlex } from \"@/components/atoms\";\nimport {\n  OakCodeRenderer,\n  OakDragAndDropInstructions,\n  OakDraggable,\n  OakDroppable,\n} from \"@/components/molecules\";\nimport { InternalDndContext } from \"@/components/atoms/InternalDndContext/InternalDndContext\";\nimport { usePrefersReducedMotion } from \"@/animation/usePrefersReducedMotion\";\n\ntype OakQuizOrderItem = {\n  id: string;\n  label: string;\n};\n\nexport type OakQuizOrderProps = {\n  /**\n   * The initial order of items\n   *\n   * this cannot be updated on subsequent renders\n   */\n  initialItems: OakQuizOrderItem[];\n  /**\n   * Notified the consumer when the order of items has changed\n   */\n  onChange?: (items: OakQuizOrderItem[]) => void;\n  /**\n   * Highlight all items to indicate that they can be interacted with\n   */\n  isHighlighted?: boolean;\n};\n\nconst ConnectedDraggable = ({\n  id,\n  label,\n  isHighlighted,\n}: OakQuizOrderItem & { isHighlighted?: boolean }) => {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isOver,\n    isDragging,\n  } = useSortable({ id });\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n  };\n\n  return (\n    <OakDroppable isOver={isOver} isHighlighted={isHighlighted}>\n      <OakDraggable\n        ref={setNodeRef}\n        style={style}\n        isDisabled={isDragging}\n        {...attributes}\n        {...listeners}\n        aria-describedby={undefined}\n        aria-roledescription=\"sortable item\"\n        aria-pressed={undefined}\n        aria-selected={!!attributes[\"aria-pressed\"]}\n        role=\"option\"\n      >\n        <OakCodeRenderer string={label} />\n      </OakDraggable>\n    </OakDroppable>\n  );\n};\n\n/**\n * A sortable list of items with drag and drop functionality. Items can be dragged over named slots to re-arrange them\n *\n * Keyboard navigation is supported with the `tab`, `space` and `arrow` keys\n */\nexport const OakQuizOrder = ({\n  initialItems,\n  onChange,\n  isHighlighted,\n}: OakQuizOrderProps) => {\n  const [items, setItems] = useState<OakQuizOrderItem[]>(initialItems);\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const activeItem = items.find((item) => item.id === activeId);\n  const sensors = useSensors(\n    useSensor(MouseSensor),\n    useSensor(TouchSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n      scrollBehavior: usePrefersReducedMotion() ? \"instant\" : \"smooth\",\n    }),\n  );\n\n  return (\n    <>\n      <OakDragAndDropInstructions $mb=\"space-between-m2\" />\n      <InternalDndContext\n        sensors={sensors}\n        collisionDetection={closestCenter}\n        onDragEnd={handleDragEnd}\n        onDragStart={handleDragStart}\n        accessibility={{\n          announcements: createAccouncements(items),\n        }}\n      >\n        <SortableContext items={items} strategy={verticalListSortingStrategy}>\n          <OakFlex\n            $gap=\"space-between-s\"\n            $flexDirection=\"column\"\n            role=\"listbox\"\n            aria-label=\"Sortable items\"\n          >\n            {items.map((item) => (\n              <ConnectedDraggable\n                key={item.id}\n                {...item}\n                isHighlighted={isHighlighted}\n              />\n            ))}\n          </OakFlex>\n          {createPortal(\n            <DragOverlay>\n              {activeItem && (\n                <OakDraggable isDragging>\n                  <OakCodeRenderer string={activeItem.label} />\n                </OakDraggable>\n              )}\n            </DragOverlay>,\n            document.body,\n          )}\n        </SortableContext>\n      </InternalDndContext>\n    </>\n  );\n\n  function handleDragStart(event: DragStartEvent) {\n    const { active } = event;\n    setActiveId(active.id.toString());\n  }\n\n  function handleDragEnd(event: DragEndEvent) {\n    const { active, over } = event;\n\n    if (active.id !== over?.id) {\n      setItems((items) => {\n        const oldIndex = items.findIndex((item) => item.id === active.id);\n        const newIndex = items.findIndex((item) => item.id === over?.id);\n        const newItems = arrayMove(items, oldIndex, newIndex);\n\n        onChange?.(newItems);\n\n        return newItems;\n      });\n    }\n\n    setActiveId(null);\n  }\n};\n\nfunction createAccouncements(items: OakQuizOrderItem[]): Announcements {\n  const getPosition = (id: UniqueIdentifier) =>\n    items.findIndex((item) => item.id === id) + 1;\n  const getItemLabel = (id: UniqueIdentifier) =>\n    items.find((item) => item.id === id)?.label;\n\n  return {\n    onDragStart() {\n      return undefined;\n    },\n    onDragOver({ active, over }) {\n      if (over) {\n        return `Sortable item ${getItemLabel(\n          active.id,\n        )} is in position ${getPosition(over.id)} of ${items.length}`;\n      }\n    },\n    onDragEnd({ active, over }) {\n      if (over) {\n        return `Sortable item ${getItemLabel(\n          active.id,\n        )} was dropped into position ${getPosition(over.id)} of ${\n          items.length\n        }`;\n      }\n    },\n    onDragCancel({ active }) {\n      return `Dragging was cancelled. Sortable item ${getItemLabel(\n        active.id,\n      )} was dropped.`;\n    },\n  };\n}\n"],"names":["ConnectedDraggable","id","label","isHighlighted","attributes","listeners","setNodeRef","transform","transition","isOver","isDragging","useSortable","style","CSS","Transform","toString","React","createElement","OakDroppable","OakDraggable","ref","isDisabled","undefined","role","default","OakCodeRenderer","string","createAccouncements","items","getPosition","findIndex","item","getItemLabel","find","onDragStart","onDragOver","active","over","length","onDragEnd","onDragCancel","initialItems","onChange","setItems","useState","activeId","setActiveId","activeItem","sensors","useSensors","useSensor","MouseSensor","TouchSensor","KeyboardSensor","coordinateGetter","sortableKeyboardCoordinates","scrollBehavior","usePrefersReducedMotion","Fragment","OakDragAndDropInstructions","$mb","InternalDndContext","collisionDetection","closestCenter","event","oldIndex","newIndex","newItems","arrayMove","accessibility","announcements","SortableContext","strategy","verticalListSortingStrategy","OakFlex","$gap","$flexDirection","map","key","createPortal","DragOverlay","document","body"],"mappings":"4qHAwDA,MAAMA,EAAqB,EACzBC,KACAC,QACAC,oBAEA,MAAMC,WACJA,EAAUC,UACVA,EAASC,WACTA,EAAUC,UACVA,EAASC,WACTA,EAAUC,OACVA,EAAMC,WACNA,GACEC,EAAAA,YAAY,CAAEV,OACZW,EAAQ,CACZL,UAAWM,EAAGA,IAACC,UAAUC,SAASR,GAClCC,cAGF,OACEQ,EAAAA,QAACC,cAAAC,EAAYA,aAAC,CAAAT,OAAQA,EAAQN,cAAeA,GAC3Ca,EAAAA,QAAAC,cAACE,eAAY,CACXC,IAAKd,EACLM,MAAOA,EACPS,WAAYX,KACRN,KACAC,EAAS,wBACKiB,EAAS,uBACN,gBAAe,oBACtBA,EACC,kBAAElB,EAAW,gBAC5BmB,KAAK,UAELP,EAACQ,QAAAP,cAAAQ,mBAAgBC,OAAQxB,KAG7B,EA2FJ,SAASyB,EAAoBC,GAC3B,MAAMC,EAAe5B,GACnB2B,EAAME,WAAWC,GAASA,EAAK9B,KAAOA,IAAM,EACxC+B,EAAgB/B,GACpB2B,EAAMK,MAAMF,GAASA,EAAK9B,KAAOA,KAAKC,MAExC,MAAO,CACL,WAAAgC,GAEC,EACD,UAAAC,EAAWC,OAAEA,EAAMC,KAAEA,IACnB,GAAIA,EACF,MAAO,iBAAiBL,EACtBI,EAAOnC,sBACW4B,EAAYQ,EAAKpC,UAAU2B,EAAMU,QAExD,EACD,SAAAC,EAAUH,OAAEA,EAAMC,KAAEA,IAClB,GAAIA,EACF,MAAO,iBAAiBL,EACtBI,EAAOnC,iCACsB4B,EAAYQ,EAAKpC,UAC9C2B,EAAMU,QAGX,EACDE,aAAY,EAACJ,OAAEA,KACN,yCAAyCJ,EAC9CI,EAAOnC,mBAIf,sBAnH4B,EAC1BwC,eACAC,WACAvC,oBAEA,MAAOyB,EAAOe,GAAYC,EAAQA,SAAqBH,IAChDI,EAAUC,GAAeF,EAAQA,SAAgB,MAClDG,EAAanB,EAAMK,MAAMF,GAASA,EAAK9B,KAAO4C,IAC9CG,EAAUC,aACdC,EAAAA,UAAUC,EAAWA,aACrBD,EAAAA,UAAUE,EAAWA,aACrBF,EAASA,UAACG,iBAAgB,CACxBC,iBAAkBC,EAA2BA,4BAC7CC,eAAgBC,EAAAA,0BAA4B,UAAY,YAI5D,OACEzC,UAAAC,cAAAD,EAAAQ,QAAAkC,SAAA,KACE1C,EAAAA,QAACC,cAAA0C,EAAAA,2BAA+B,CAAAC,IAAA,qBAChC5C,EAAAA,QAAAC,cAAC4C,EAAAA,mBACC,CAAAb,QAASA,EACTc,mBAAoBC,EAAaA,cACjCxB,UAyCN,SAAuByB,GACrB,MAAM5B,OAAEA,EAAMC,KAAEA,GAAS2B,EAErB5B,EAAOnC,KAAOoC,GAAMpC,IACtB0C,GAAUf,IACR,MAAMqC,EAAWrC,EAAME,WAAWC,GAASA,EAAK9B,KAAOmC,EAAOnC,KACxDiE,EAAWtC,EAAME,WAAWC,GAASA,EAAK9B,KAAOoC,GAAMpC,KACvDkE,EAAWC,EAASA,UAACxC,EAAOqC,EAAUC,GAI5C,OAFAxB,IAAWyB,GAEJA,CAAQ,IAInBrB,EAAY,KACb,EAxDKZ,YAmCN,SAAyB8B,GACvB,MAAM5B,OAAEA,GAAW4B,EACnBlB,EAAYV,EAAOnC,GAAGc,WACvB,EArCKsD,cAAe,CACbC,cAAe3C,EAAoBC,KAGrCZ,EAACQ,QAAAP,cAAAsD,mBAAgB3C,MAAOA,EAAO4C,SAAUC,+BACvCzD,EAAAA,QAAAC,cAACyD,EAAAA,QACM,CAAAC,KAAA,kBACUC,eAAA,SACfrD,KAAK,UAAS,aACH,kBAEVK,EAAMiD,KAAK9C,GACVf,EAAAA,QAACC,cAAAjB,GACC8E,IAAK/C,EAAK9B,MACN8B,EACJ5B,cAAeA,OAIpB4E,EAAAA,aACC/D,EAACQ,QAAAP,cAAA+D,EAAAA,YACE,KAAAjC,GACC/B,EAAAQ,QAAAP,cAACE,EAAAA,aAAY,CAACT,YAAU,GACtBM,EAAAA,QAACC,cAAAQ,EAAAA,iBAAgBC,OAAQqB,EAAW7C,UAI1C+E,SAASC,QA4BlB"}