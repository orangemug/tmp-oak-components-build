{"version":3,"file":"OakCookieConsentProvider.js","sources":["../../../../../../src/components/organisms/shared/OakCookieConsentProvider/OakCookieConsentProvider.tsx"],"sourcesContent":["import React, {\n  ReactNode,\n  createContext,\n  useCallback,\n  useContext,\n  useReducer,\n} from \"react\";\n\nimport {\n  CookieConsentReducerState,\n  cookieConsentReducer,\n  getInitialState,\n} from \"./cookieConsentReducer\";\n\ntype Party = {\n  name: ReactNode;\n  url: string;\n};\nexport type Consent = {\n  /**\n   * Unique identifier for the policy.\n   */\n  policyId: string;\n  /**\n   * The user's consent state for the policy.\n   */\n  consentState: ConsentState;\n};\nexport type PolicyConsent = {\n  /**\n   * Unique identifier for the policy.\n   */\n  policyId: string;\n  /**\n   * Label for the policy.\n   */\n  policyLabel: string;\n  /**\n   * Description of the policy. This should explain what the policy does and why it is needed.\n   */\n  policyDescription: ReactNode;\n  /**\n   * Whether the policy is strictly necessary for the site to function.\n   * If true, the policy will be enabled by default and cannot be disabled.\n   */\n  isStrictlyNecessary: boolean;\n  /**\n   * List of 3rd parties that the policy allows data to be shared with.\n   */\n  policyParties: Party[];\n  /**\n   * The current consent state of the policy\n   */\n  consentState: ConsentStateWithPending;\n};\nexport type ConsentState = \"granted\" | \"denied\";\nexport type ConsentStateWithPending = ConsentState | \"pending\";\n\nexport type OakCookieConsentContextType = {\n  /**\n   * Whether the cookie settings modal is open.\n   */\n  isSettingsModalOpen: boolean;\n  /**\n   * List of cookie policies with the current consent state.\n   */\n  policyConsents: PolicyConsent[];\n  /**\n   * Open the cookie settings modal.\n   **/\n  openSettings(): void;\n  /**\n   * Close the cookie settings modal.\n   */\n  closeSettings(): void;\n  /**\n   * Show the cookie consent banner.\n   */\n  showBanner(): void;\n  /**\n   * Hide the cookie consent banner.\n   */\n  hideBanner(): void;\n  /**\n   * Reject all non-essential cookies from the settings modal.\n   */\n  rejectModalConsents(): void;\n  /**\n   * Confirm the user's consent settings from the modal.\n   * @param consents The user's chosen consent settings.\n   */\n  confirmModalConsents(consents: Consent[]): void;\n  /**\n   * Consent to all cookies from the modal.\n   */\n  acceptModalConsents(): void;\n  /**\n   * Reject all non-essential cookies from the banner.\n   */\n  rejectBannerConsents(): void;\n  /**\n   * Accept all cookies from the banner.\n   */\n  acceptBannerConsents(): void;\n  /**\n   * The current state of the cookie banner.\n   */\n  bannerState: CookieConsentReducerState[\"bannerState\"];\n};\n\nexport function getDefaultContextState(): OakCookieConsentContextType {\n  return {\n    isSettingsModalOpen: false,\n    policyConsents: [],\n    showBanner() {},\n    hideBanner() {},\n    openSettings() {},\n    closeSettings() {},\n    rejectModalConsents() {},\n    confirmModalConsents() {},\n    acceptModalConsents() {},\n    rejectBannerConsents() {},\n    acceptBannerConsents() {},\n    bannerState: \"initial\",\n  };\n}\n\nexport const OakCookieConsentContext =\n  createContext<OakCookieConsentContextType>(getDefaultContextState());\n\nexport type OakCookieConsentProviderProps = Pick<\n  OakCookieConsentContextType,\n  \"policyConsents\"\n> & {\n  children: ReactNode;\n  /**\n   * Callback triggered when the user's consent settings change.\n   * @param consents The user's updated consent settings.\n   */\n  onConsentChange(consents: Consent[]): void;\n};\n\n/**\n * Internal hook for consuming the OakCookieConsentContext.\n *\n * This should not be exported from the package.\n */\nexport function useInternalCookieConsent() {\n  return useContext(OakCookieConsentContext);\n}\n\n/**\n * Enables opening of the cookie settings modal and showing the cookie consent banner.\n */\nexport function useCookieConsent() {\n  const { showBanner, openSettings } = useContext(OakCookieConsentContext);\n  return { showBanner, openSettings };\n}\n\n/**\n * Provides a context through which the cookie consent UI can be configured and controlled\n *\n * Intended to be used with `OakCookieConsent`\n */\nexport const OakCookieConsentProvider = ({\n  children,\n  policyConsents,\n  onConsentChange,\n}: OakCookieConsentProviderProps) => {\n  const [cookieConsentState, dispatch] = useReducer(\n    cookieConsentReducer,\n    null,\n    getInitialState,\n  );\n  const closeSettings = useCallback(() => dispatch({ type: \"closeModal\" }), []);\n  const acceptConsents = useCallback(() => {\n    onConsentChange(\n      policyConsents.map(({ policyId }) => ({\n        policyId,\n        consentState: \"granted\",\n      })),\n    );\n  }, [onConsentChange, policyConsents]);\n  const rejectConsents = useCallback(() => {\n    onConsentChange(\n      policyConsents.map(({ policyId, isStrictlyNecessary }) => ({\n        policyId,\n        consentState: isStrictlyNecessary ? \"granted\" : \"denied\",\n      })),\n    );\n  }, [onConsentChange, policyConsents]);\n  const hideBanner = useCallback(() => dispatch({ type: \"hideBanner\" }), []);\n  const showBanner = useCallback(() => dispatch({ type: \"showBanner\" }), []);\n  const openSettings = useCallback(() => dispatch({ type: \"openModal\" }), []);\n  const acceptBannerConsents = useCallback(() => {\n    acceptConsents();\n    dispatch({ type: \"acceptBannerConsents\" });\n  }, [acceptConsents]);\n  const rejectBannerConsents = useCallback(() => {\n    rejectConsents();\n    dispatch({ type: \"rejectBannerConsents\" });\n  }, [rejectConsents]);\n  const acceptModalConsents = useCallback(() => {\n    acceptConsents();\n    dispatch({ type: \"acceptModalConsents\" });\n  }, [acceptConsents, hideBanner]);\n  const rejectModalConsents = useCallback(() => {\n    rejectConsents();\n    dispatch({ type: \"rejectModalConsents\" });\n  }, [rejectConsents, hideBanner]);\n  const confirmModalConsents = useCallback(\n    (consents: Consent[]) => {\n      onConsentChange(consents);\n      dispatch({ type: \"confirmModalConsents\" });\n    },\n    [onConsentChange, hideBanner],\n  );\n\n  return (\n    <OakCookieConsentContext.Provider\n      value={{\n        isSettingsModalOpen: cookieConsentState.isSettingsModalOpen,\n        bannerState: cookieConsentState.bannerState,\n        policyConsents,\n        showBanner,\n        hideBanner,\n        openSettings,\n        closeSettings,\n        confirmModalConsents,\n        acceptBannerConsents,\n        rejectBannerConsents,\n        acceptModalConsents,\n        rejectModalConsents,\n      }}\n    >\n      {children}\n    </OakCookieConsentContext.Provider>\n  );\n};\n"],"names":["getDefaultContextState","isSettingsModalOpen","policyConsents","showBanner","hideBanner","openSettings","closeSettings","rejectModalConsents","confirmModalConsents","acceptModalConsents","rejectBannerConsents","acceptBannerConsents","bannerState","OakCookieConsentContext","createContext","children","onConsentChange","cookieConsentState","dispatch","useReducer","cookieConsentReducer","getInitialState","useCallback","type","acceptConsents","map","policyId","consentState","rejectConsents","isStrictlyNecessary","consents","React","default","createElement","Provider","value","useContext"],"mappings":"uKA8GgBA,IACd,MAAO,CACLC,qBAAqB,EACrBC,eAAgB,GAChB,UAAAC,GAAe,EACf,UAAAC,GAAe,EACf,YAAAC,GAAiB,EACjB,aAAAC,GAAkB,EAClB,mBAAAC,GAAwB,EACxB,oBAAAC,GAAyB,EACzB,mBAAAC,GAAwB,EACxB,oBAAAC,GAAyB,EACzB,oBAAAC,GAAyB,EACzBC,YAAa,UAEjB,OAEaC,EACXC,EAAAA,cAA2Cd,wEAoCL,EACtCe,WACAb,iBACAc,sBAEA,MAAOC,EAAoBC,GAAYC,EAAUA,WAC/CC,uBACA,KACAC,EAAAA,iBAEIf,EAAgBgB,EAAWA,aAAC,IAAMJ,EAAS,CAAEK,KAAM,gBAAiB,IACpEC,EAAiBF,EAAAA,aAAY,KACjCN,EACEd,EAAeuB,KAAI,EAAGC,eAAgB,CACpCA,WACAC,aAAc,cAEjB,GACA,CAACX,EAAiBd,IACf0B,EAAiBN,EAAAA,aAAY,KACjCN,EACEd,EAAeuB,KAAI,EAAGC,WAAUG,0BAA2B,CACzDH,WACAC,aAAcE,EAAsB,UAAY,aAEnD,GACA,CAACb,EAAiBd,IACfE,EAAakB,EAAWA,aAAC,IAAMJ,EAAS,CAAEK,KAAM,gBAAiB,IACjEpB,EAAamB,EAAWA,aAAC,IAAMJ,EAAS,CAAEK,KAAM,gBAAiB,IACjElB,EAAeiB,EAAWA,aAAC,IAAMJ,EAAS,CAAEK,KAAM,eAAgB,IAClEZ,EAAuBW,EAAAA,aAAY,KACvCE,IACAN,EAAS,CAAEK,KAAM,wBAAyB,GACzC,CAACC,IACEd,EAAuBY,EAAAA,aAAY,KACvCM,IACAV,EAAS,CAAEK,KAAM,wBAAyB,GACzC,CAACK,IACEnB,EAAsBa,EAAAA,aAAY,KACtCE,IACAN,EAAS,CAAEK,KAAM,uBAAwB,GACxC,CAACC,EAAgBpB,IACdG,EAAsBe,EAAAA,aAAY,KACtCM,IACAV,EAAS,CAAEK,KAAM,uBAAwB,GACxC,CAACK,EAAgBxB,IACdI,EAAuBc,eAC1BQ,IACCd,EAAgBc,GAChBZ,EAAS,CAAEK,KAAM,wBAAyB,GAE5C,CAACP,EAAiBZ,IAGpB,OACE2B,EAACC,QAAAC,cAAApB,EAAwBqB,SAAQ,CAC/BC,MAAO,CACLlC,oBAAqBgB,EAAmBhB,oBACxCW,YAAaK,EAAmBL,YAChCV,iBACAC,aACAC,aACAC,eACAC,gBACAE,uBACAG,uBACAD,uBACAD,sBACAF,wBAGDQ,EAEH,uEAlFF,MAAMZ,WAAEA,EAAUE,aAAEA,GAAiB+B,EAAUA,WAACvB,GAChD,MAAO,CAAEV,aAAYE,eACvB,8CATE,OAAO+B,EAAAA,WAAWvB,EACpB"}